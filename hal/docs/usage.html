
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2021-02-28
 Rendered using Reflow Maven Skin 1.1.0-SNAPSHOT (https://github.com/wcm-io/wcm-io-tooling/tree/develop/maven/skins/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

  <head>
    <meta charset="UTF-8" />
    <title>HAL Interface Documentation usage | HAL Interface Documentation</title>

    <link rel="shortcut icon" href="https://wcm.io/images/favicon.ico">
    <link rel="apple-touch-icon" href="https://wcm.io/images/favicon-152.png">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="wcm.io Caravan - JSON Data Pipelining Infrastructure" />
    <meta http-equiv="content-language" content="en" />
 
    <link href="../../css/bootstrap.min.css" rel="stylesheet" />
    <link href="../../css/docs.css" rel="stylesheet" />
    <link href="../../css/reflow-skin.css" rel="stylesheet" />
    <link href="../../css/highlightjs-style-github.min.css" rel="stylesheet" />

    <link href="../../css/lightbox.css" rel="stylesheet" />

    <link href="../../css/site.css" rel="stylesheet" />
    <link href="../../css/print.css" rel="stylesheet" media="print" />


  </head>

  <body class="page-usage project-io.wcm.caravan.hal.docs" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="../..">wcm.io Caravan</a>
          <div class="nav-collapse collapse" id="top-nav-collapse">
            <ul class="nav pull-right">
              <li ><a href="http://github.com/wcm-io-caravan" title="GitHub project" class="externalLink">GitHub project</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Categories <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li ><a href="../../commons/" title="Commons">Commons</a></li>
                  <li ><a href="../" title="HAL">HAL</a></li>
                  <li ><a href="../../rhyme/" title="Rhyme">Rhyme</a></li>
                  <li ><a href="../../io/" title="I/O">I/O</a></li>
                  <li ><a href="../../jaxrs/" title="JAX-RS">JAX-RS</a></li>
                  <li ><a href="../../jaxws/" title="JAX-WS">JAX-WS</a></li>
                  <li ><a href="../../pipeline/" title="Pipeline">Pipeline</a></li>
                  <li ><a href="../../testing/" title="Testing">Testing</a></li>
                  <li ><a href="../../packaging/" title="Packaging">Packaging</a></li>
                  <li ><a href="../../tooling/" title="Tooling">Tooling</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contribute <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li ><a href="https://wcm.io/contribute.html" title="Contribute" class="externalLink">Contribute</a></li>
                  <li ><a href="https://wcm-io.atlassian.net" title="Issues" class="externalLink">Issues</a></li>
                  <li ><a href="https://wcm-io.atlassian.net/wiki/" title="Wiki" class="externalLink">Wiki</a></li>
                  <li ><a href="https://wcm.io/mailing-lists.html" title="Mailing Lists" class="externalLink">Mailing Lists</a></li>
                  <li ><a href="http://github.com/wcm-io-caravan" title="Fork on GitHub" class="externalLink">Fork on GitHub</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

  <div class="container">

  <!-- Masthead
  ================================================== -->

  <header>
  <div class="jumbotron subhead">
    <div class="row" id="banner">
      <div class="span12">
        <div class="pull-left">
          <a href="../../" id="bannerLeft"><h1><img src="https://wcm.io/images/favicon-16@3x.png"/> wcm.io Caravan</h1></a>
          <p class="lead">JSON Data Pipelining Infrastructure</p>
        </div>
        <div class="pull-right">
          <div id="bannerRight"><h1><img src="https://caravan.wcm.io/images/caravan.gif" style="width:350px"/></h1></div>
        </div>
      </div>
    </div>
  </div>
    <div>
      <ul class="breadcrumb">
        <li><a href="../../" title="wcm.io Caravan">wcm.io Caravan</a></li>
        <li class="divider">/</li>
        <li><a href="../index.html" title="HAL">HAL</a></li>
        <li class="divider">/</li>
        <li><a href="index.html" title="HAL Interface Documentation">HAL Interface Documentation</a></li>
        <li class="divider">/</li>
        <li>HAL Interface Documentation usage</li>
      </ul>
    </div>
  </header>

  <div class="main-body">
  <div class="row">
    <div class="span8">
      <div class="body-content">
<section> 
 <div class="page-header">
  <h2 id="HAL_Interface_Documentation_usage">HAL Interface Documentation usage</h2>
 </div> 
 <section> 
  <h3 id="Document_link_relations">Document link relations</h3> 
  <p>First make sure you have a proper name and description in the POM of your RESTful service project. They will be used as part of the documentation.</p> 
  <p>To show the correct documentation at run time a JSON file with documentation metadata needs to be created when the bundle is compile. To activate this add this plugins to your POM:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>&lt;plugin&gt;
  &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
  &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt;
  &lt;configuration&gt;
    &lt;instructions&gt;
      &lt;Caravan-JaxRs-ApplicationPath&gt;/myproject/myservice&lt;/Caravan-JaxRs-ApplicationPath&gt;
    &lt;/instructions&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;

&lt;plugin&gt;
  &lt;groupId&gt;io.wcm.caravan.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;hal-docs-maven-plugin&lt;/artifactId&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;goals&gt;
        &lt;goal&gt;generate-hal-docs-json&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;          
  &lt;/executions&gt;
&lt;/plugin&gt;
</pre> 
   </div> 
  </div> 
  <p>The Service ID is detected automatically from the <code>Caravan-JaxRs-ApplicationPath</code> of the <code>maven-bundle-plugin</code>.</p> 
  <p>You have to create an annotated <code>ServiceInfo</code> class within your bundle which contains a constant for each link relation and additional documentation metadata. The name of the class is not relevant and it does not have to be exported via OSGi, it is only inspected at compile time. But the link relation constants defined in the project should be used in the implementation code of the service as well to have a single source of truth for them.</p> 
  <p>Example:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>/**
 * This is a service description.
 * &lt;p&gt;You can use HTML tags with &lt;strong&gt;formatting&lt;/strong&gt; as well here.&lt;/p&gt;.
 */
@ServiceDoc
public final class ServiceInfo {

  private ServiceInfo() {
    // constants only
  }

  /**
   * This is the documentation of the "self" link relation.
   */
  @LinkRelationDoc
  public static final String SELF = "self";

  /**
   * If the resource contains nested HAL resources their link relations should be referenced here.
   */
  @LinkRelationDoc(links = {
      @LinkRelationRefDoc("myapi:item1"),
      @LinkRelationRefDoc(value = "myapi:item2", 
        description = "A description specific to the relation of rel1 and item2")
  })
  public static final String REL1 = "myapi:rel1";

  /**
   * To document the payload JSON of the HAL reponse either a JSON schema reference or a model 
   * class can be given. If it is a model class the JSON schema reference is detected 
   * automatically if the schema was published with the haldocs-maven-plugin as well.
   * Embedded resources can be described as well.
   */
  @LinkRelationDoc(model = Rel2Model.class, embedded = {
      @ResourceRefDoc(value = "item", model = Item.class)
  })
  public static final String REL2 = "myapi:rel2";

}
</pre> 
   </div> 
  </div> 
  <p>The RESTful service produces HAL resources and link that just contain the link relations, no curie links or link titles have to be added. They are added by the HAL docs implementation automatically. To make this happen a <code>HalDocsAugmenter</code> has to be integrated in your JAX-RS message body writer. Example:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>@Component
@Service(value = JaxRsComponent.class, serviceFactory = true)
@Property(name = JaxRsComponent.PROPERTY_GLOBAL_COMPONENT, value = "true")
@Provider
@Produces(HalResource.CONTENT_TYPE)
public class HalResourceMessageBodyWriter implements MessageBodyWriter&lt;HalResource&gt;, JaxRsComponent {

  @Reference
  private HalDocsAugmenterFactory halDocsAugmenterFactory;

  private JsonNodeMessageBodyWriter jsonWriter = new JsonNodeMessageBodyWriter();
  private HalDocsAugmenter halDocsAugmenter;

  @Activate
  protected void activate(ComponentContext componentContext) {
    halDocsAugmenter = halDocsAugmenterFactory.create(componentContext.getUsingBundle());
  }

  @Override
  public boolean isWriteable(Class&lt;?&gt; type, Type genericType, Annotation[] annotations,
      MediaType mediaType) {
    return (HalResource.class.isAssignableFrom(type));
  }

  @Override
  public long getSize(HalResource t, Class&lt;?&gt; type, Type genericType, Annotation[] annotations,
      MediaType mediaType) {
    return -1;
  }

  @Override
  public void writeTo(HalResource t, Class&lt;?&gt; type, Type genericType, Annotation[] annotations, 
      MediaType mediaType, MultivaluedMap&lt;String, Object&gt; httpHeaders, OutputStream entityStream)
      throws IOException, WebApplicationException {
    halDocsAugmenter.augment(t);
    jsonWriter.writeTo(t.getModel(), JsonNode.class, genericType, annotations, mediaType, 
        httpHeaders, entityStream);
  }

}
</pre> 
   </div> 
  </div> 
  <p>With this the documentation links integrated in the HAL browser will work and link to a service documentation generated on the fly out of the documentation JSON metadata generated by the maven plugin and included in the bundle.</p> 
 </section> 
 <section> 
  <h3 id="Publish_JSON_schema_files_for_domain_models">Publish JSON schema files for domain models</h3> 
  <p>If you want to reference model classes with JSON schema files automatic generated from the HAL documentation those model files should be put to a separate bundle which contain only the model classes.</p> 
  <p>Add this plugins to the POM:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>&lt;plugin&gt;
  &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
  &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt;
  &lt;configuration&gt;
    &lt;instructions&gt;
      &lt;Caravan-HalDocs-DomainPath&gt;/myproject/mydomainmodels&lt;/Caravan-HalDocs-DomainPath&gt;
    &lt;/instructions&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;

&lt;plugin&gt;
  &lt;groupId&gt;io.wcm.caravan.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;hal-docs-maven-plugin&lt;/artifactId&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;goals&gt;
        &lt;goal&gt;generate-json-schema&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;includes&gt;
          &lt;include&gt;my.project.models.*&lt;/include&gt;
        &lt;/includes&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;          
  &lt;/executions&gt;
&lt;/plugin&gt;
</pre> 
   </div> 
  </div> 
  <p>The include/exclude patterns define which package names contain the classes to generated the JSON schema files for.</p> 
  <p>The link between the bundle containing the RESTful service implementation and the bundle with the generated JSON schema files is detected automatically if a Maven compile dependency exists between them.</p> 
  <p>The JSON schema is displayed graphically with the <a class="externalLink" href="https://github.com/lbovet/docson">Docson JavaScript widget</a> within the documentation.</p> 
  <p>To add documentation to the domain model’s properties use the Jackson <code>@JsonPropertyDescription</code> annotation. Example:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>public final class Rel2Model {

  private String key;

  @JsonPropertyDescription("This is the description for the key property")
  public String getKey() {
    return this.key;
  }

  public Brochure setKey(String value) {
    this.key = value;
    return this;
  }

}
</pre> 
   </div> 
  </div> 
 </section> 
</section>
      </div>
    </div>
    <div class="span4">
      <div id="toc-sidebar">
        <div class="well">
          <ul class="nav nav-list">
            <li class="nav-header">Table of Contents</li>
    <li class="dropdown"><a href="#HAL_Interface_Documentation_usage" title="HAL Interface Documentation usage">HAL Interface Documentation usage <b class="caret"></b></a>
      <ul class="nav nav-list">
    <li><a href="#Document_link_relations" title="Document link relations">Document link relations</a>
    <li><a href="#Publish_JSON_schema_files_for_domain_models" title="Publish JSON schema files for domain models">Publish JSON schema files for domain models</a>
        <li class="divider"></li>
      </ul>
    </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  </div>

  </div>

  <!-- Footer
  ================================================== -->
  <footer class="well">
    <div class="container">
      <div class="row">
        <div class="span2 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Main</li>
            <li >
              <a href="../../" title="Home">Home</a>
            </li>
            <li >
              <a href="../../platforms.html" title="Platforms">Platforms</a>
            </li>
            <li >
              <a href="../../maven.html" title="Maven Repositories">Maven Repositories</a>
            </li>
            <li >
              <a href="http://github.com/wcm-io-caravan" title="GitHub project" class="externalLink">GitHub project</a>
            </li>
            <li >
              <a href="https://wcm.io/subprojects.html" title="Subprojects" class="externalLink">Subprojects</a>
            </li>
            <li >
              <a href="../../license.html" title="License">License</a>
            </li>
            <li >
              <a href="https://wcm.io/commercial-support.html" title="Commercial Support" class="externalLink">Commercial Support</a>
            </li>
            <li >
              <a href="https://wcm.io/imprint.html" title="Imprint" class="externalLink">Imprint</a>
            </li>
            <li >
              <a href="https://wcm.io/privacy.html" title="Privacy Policy" class="externalLink">Privacy Policy</a>
            </li>
          </ul>
        </div>
        <div class="span2 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Categories</li>
            <li >
              <a href="../../commons/" title="Commons">Commons</a>
            </li>
            <li >
              <a href="../" title="HAL">HAL</a>
            </li>
            <li >
              <a href="../../rhyme/" title="Rhyme">Rhyme</a>
            </li>
            <li >
              <a href="../../io/" title="I/O">I/O</a>
            </li>
            <li >
              <a href="../../jaxrs/" title="JAX-RS">JAX-RS</a>
            </li>
            <li >
              <a href="../../jaxws/" title="JAX-WS">JAX-WS</a>
            </li>
            <li >
              <a href="../../pipeline/" title="Pipeline">Pipeline</a>
            </li>
            <li >
              <a href="../../testing/" title="Testing">Testing</a>
            </li>
            <li >
              <a href="../../packaging/" title="Packaging">Packaging</a>
            </li>
            <li >
              <a href="../../tooling/" title="Tooling">Tooling</a>
            </li>
          </ul>
        </div>
        <div class="span2 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Contribute</li>
            <li >
              <a href="https://wcm.io/contribute.html" title="Contribute" class="externalLink">Contribute</a>
            </li>
            <li >
              <a href="https://wcm-io.atlassian.net" title="Issues" class="externalLink">Issues</a>
            </li>
            <li >
              <a href="https://wcm-io.atlassian.net/wiki/" title="Wiki" class="externalLink">Wiki</a>
            </li>
            <li >
              <a href="https://wcm.io/mailing-lists.html" title="Mailing Lists" class="externalLink">Mailing Lists</a>
            </li>
            <li >
              <a href="http://github.com/wcm-io-caravan" title="Fork on GitHub" class="externalLink">Fork on GitHub</a>
            </li>
          </ul>
        </div>
        <div class="span3 bottom-nav">
          <ul class="nav nav-list">
            <li class="nav-header">Maven documentation</li>
            <li >
              <a href="project-info.html" title="Project Information">Project Information <i class="icon-chevron-right"></i></a>
            </li>
            <li >
              <a href="project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
            </li>
          </ul>
        </div>
        <div class="span3 bottom-description">
          <blockquote>wcm.io Caravan is an Open Source project which provides a JSON Data Pipelining Infrastructure for building RESTful Micro Services.</blockquote>
        </div>
      </div>
    </div>
  </footer>

  <div class="container subfooter">
    <div class="row">
      <div class="span12">
        <p class="pull-right"><a href="#">Back to top</a></p>
        <p class="copyright">Copyright &copy;2014-2021 <a href="https://caravan.wcm.io">wcm.io Caravan</a>. All Rights Reserved.</p>
        <p class="version-date"><span class="projectVersion">Version: 0.6.1-SNAPSHOT. </span><span class="publishDate">Last Published: 2021-02-28. </span></p>
      </div>
    </div>
  </div>

  <!-- JavaScript
  ================================================== -->
  <script src="../../js/jquery.min.js"></script>
  <script src="../../js/bootstrap.min.js"></script>
  <script src="../../js/lightbox.min.js"></script>
  <script src="../../js/reflow-scroll.js"></script>
  <script src="../../js/highlight.min.js"></script>


  <script src="../../js/reflow-skin.js"></script>

  </body>
</html>